<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:composition>
		<h:panelGroup rendered="#{sessionScope.role == 'Patient'}">
		<div class="card">
			<img src="#{resource['images/patient.jpg']}" alt="pharmacist"
				style="width: 70%"></img>
			<h1>PATIENT</h1>
			<p>Name: #{patientInfoController.currentUser.theName}</p>
			<p>ID: #{patientInfoController.currentUser.theID}</p>
			<p>email: #{patientInfoController.currentUser.theEmail}</p>

			<div style="margin: 24px 0;">
				<a href="#"><i class="fa fa-ambulance"></i></a> <a href="#"><i
					class="fa fa-plus-square"></i></a> <a href="#"><i
					class="fa fa-user-md"></i></a> <a href="#"><i
					class="fa fa-hospital-o"></i></a>
			</div>
			<h:form>
				<p:dataTable value="#{patientInfoController.currentUser.prescriptions}" var="presc">
					<p:column headerText="Name">
						<p:commandLink action = "#{patientBean.setCurrentPrescription(presc)}" value="#{presc.theName}" update="@all" style="text-decoration:none;color:blue;">
						</p:commandLink>
					</p:column>
					<p:column headerText="Date Prescribed">
						<h:outputText value="#{presc.theDatePrescribed}" />
					</p:column>
					<p:column headerText="Amount">
						<h:outputText value="#{presc.theItem.subtotal}"/>
					</p:column>
					<p:column headerText="Status">
						<h:outputText value="#{presc.theStatus}"/>
					</p:column>
					<p:column headerText="Pay">
						<p:commandButton value="Pay" actionListener="#{authorisePayment.pay(presc)}" rendered="#{presc.theStatus == 'Waiting for payment'}"/>
					</p:column>
				</p:dataTable>			
			</h:form>
			<h:form  id = "prescriptionDetailsSection">
			<p:panelGrid rendered = "#{patientBean.currentPrescription != null}">
					<h3>Prescription ID : #{patientBean.currentPrescription.theName}</h3>
				    
				    <!-- The Doctor -->
				    <p:row>
				    		<p:column colspan="2"><p:outputLabel for="doctor" value="Doctor" /></p:column>
							<p:column colspan="4">
								<h:outputText id="doctor" value = "#{patientBean.currentPrescription.theDoctor.theName}" />
							</p:column>
							
							<!-- Licence -->
							<p:column colspan="2"><p:outputLabel for="licence" value="License" /></p:column>
							<p:column colspan="4">
								<h:outputText id="licence" value = "#{patientBean.currentPrescription.theDoctor.theID}">
								</h:outputText>
							</p:column>		
				    </p:row>
				    
				    <!-- The Pharmacist -->
				    <p:row>
				    		<p:column colspan="2"><p:outputLabel for="pharmacist" value="Pharmacist  "/></p:column>
							<p:column colspan="10">
								<h:outputText id="pharmacist" value = "#{patientBean.currentPrescription.thePharmacist.theName}" />
							</p:column>
				    </p:row>
					
					<!-- Placeholder for the PrescriptionItems Datatable -->
					<p:row>
				    	<p:column colspan="12">
				    		<p:dataTable id = "items" var="item" value="#{patientBean.currentPrescription.theItems}">
							    <p:column headerText="Medicine">
							        <h:outputText value="#{item.medicine.theName}" />
							    </p:column>
							 
							    <p:column headerText="Dose per day">
							        <h:outputText value="#{item.dosagePerDay}" />
							    </p:column>
							 
							    <p:column headerText="Duration">
							        <h:outputText value="#{item.duration}" />
							    </p:column>
							    
							    <p:column headerText="Quantity">
							        <h:outputText value="#{item.quantity}" />
							    </p:column>
							    
							    <p:column headerText="Unit Price">
							        <h:outputText value="#{item.medicine.theUnitPrice}" />
							    </p:column>
							    
							    <p:column headerText="Subtotal">
							        <h:outputText value="#{item.subtotal}" />
							    </p:column>
							</p:dataTable>
				    	</p:column>
					</p:row>			
			</p:panelGrid>
			<!-- The list of videos -->
			<p:panelGrid rendered = "#{patientBean.currentPrescription != null}">	
				<div class="prescriptionVideos">
					<h:outputText value="Instructional videos for above medicines" />
					<p:growl id="growl" showDetail="true" sticky="true" />  
					<ui:repeat id = "videosList" 
							   value="#{patientBean.currentPrescription.videos}" 
							   var="video" 
							   varStatus="status">
							  	<div class = "videoContainer">
									<a href ="https://www.youtube.com/watch?v=#{video.id}" target="_blank">
										<img src="https://img.youtube.com/vi/#{video.id}/maxresdefault.jpg" style="width:148px;" alt="#{video.title}"/>								
									</a>
								</div>
					</ui:repeat> 
				</div>
			</p:panelGrid>
		</h:form>
			
		</div>
	</h:panelGroup>         
	</ui:composition>
</html>
